#include <stdio.h>
#include <ctype.h>
#include <string.h>

#define MAX_USERS 100 

void check_h(int *h){
	while(scanf("%d", h) != 1 || *h < 0 || *h > 109){
		printf("Invalid input. Try again and enter a valid height in inches.\n");
		while(getchar() != '\n');
		printf("Enter height in inches: ");
	}
}

void check_w(int *w){
	while(scanf("%d", w) != 1 || *w < 0 || *w > 600){
		printf("Invalid input. Try again and enter a valid weight in kilograms.\n");
		while(getchar() != '\n');
		printf("Enter weight in kg: ");
	}
}

void checkans(int *ans){
	char input[5];
	while(1){
		scanf("%s", input);
		
		for(int i = 0; input[i]; i++){
			input[i] = toupper(input[i]);
		}
		
		if(input[0] == '1' || strcmp(input, "Y") == 0 || strcmp(input, "YES") == 0){
			*ans = 1;
			break;
		} else if (input[0] == '0' || strcmp(input, "N") == 0 || strcmp(input, "NO") == 0){
			*ans = 0;
			break;
		}
	
		printf("Invalid input. Try again and enter either 1/Y or 0/N only.\n");
		while(getchar() != '\n');
		printf("Do you want to add another user (1/Y- YES, 0/N- NO)? ");
	}
}

float calc_bmi(int h, int w){
	float height_m = h * 0.0254;
	return w / (height_m * height_m);
}

int main(){
	int height[MAX_USERS];
	int weight[MAX_USERS];
	int count = 0;
	int ans; 
	
	printf("A program that will determine users' BMI\n");
	
	do {
		printf("User %d:\n", count + 1);
		
		printf("Enter height in inches: ");
		check_h(&height[count]);
		
		printf("Enter weight in kg: ");
		check_w(&weight[count]);
		
		count++;
		
		printf("Do you want to add another user (1/Y- YES, 0/N- NO)? ");
		checkans(&ans);
		
	} while(ans == 1 && count < MAX_USERS);
	
	// BMI Calculator
	for(int i = 0; i < count; i++){
		float bmi = calc_bmi(height[i], weight[i]);
		printf("USER %d: Height = %d in, Weight = %d kg, BMI = %.2f\n", i+1, height[i], weight[i], bmi);
		
		if(bmi < 18.5){
			printf("\e[1mUser %d is in underweight range\e[0m\n", i + 1); 
		} else if (bmi >= 18.5 && bmi <= 24.9){
			printf("\e[1mUser %d is in optimum range\e[0m\n", i + 1);
		} else if (bmi >= 25 && bmi <= 29.9){
			printf("\e[1mUser %d is in overweight range\e[0m\n", i+ 1);
		} else if (bmi >= 30){
			printf("\e[1mUser %d is in obesity range\e[0m\n", i + 1);	
		}
	}

	return 0;
}